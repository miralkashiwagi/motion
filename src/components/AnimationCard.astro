---
import { type CollectionEntry } from 'astro:content';
import PlaceholderImage from './PlaceholderImage.astro';
import { categoryMapping } from '../content/config';

interface Props {
  animation: CollectionEntry<'animations'>;
}

const { animation } = Astro.props;
const { title, description, parentCategory, category, preview, difficulty, technologies, tags } = animation.data;
const { slug } = animation;

// 難易度に基づいたバッジクラス
const difficultyClasses = {
  beginner: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400',
  intermediate: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400',
  advanced: 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400',
};

const difficultyClass = difficulty ? difficultyClasses[difficulty] : '';

// 難易度のラベル
const difficultyLabels = {
  beginner: '初級',
  intermediate: '中級',
  advanced: '上級'
};

// 親カテゴリーの色を取得
const getParentCategoryColor = (cat: string) => {
  return categoryMapping[cat]?.color || '#6b7280'; // デフォルト色
};

// プレビュー画像のパス
const previewSrc = preview || '';

// 技術タグの表示
const techTags = technologies || [];
---

<a href={`${import.meta.env.BASE_URL}/animations/${slug.replace(/^\/+/, '')}`} class="group">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
    <div class="aspect-video relative overflow-hidden bg-gray-100 dark:bg-gray-900">
      {previewSrc ? (
        <img 
          src={previewSrc} 
          alt={`Preview of ${title}`} 
          class="w-full h-full object-cover"
          loading="lazy"
        />
      ) : (
        <PlaceholderImage 
          text={title}
          className="w-full h-full"
          bgColor={getParentCategoryColor(parentCategory)}
        />
      )}
      <div class="absolute top-2 right-2 flex flex-col gap-1 items-end">
        <span class={`text-xs font-medium px-2.5 py-0.5 rounded ${difficultyClass}`}>
          {difficultyLabels[difficulty] || '未分類'}
        </span>
      </div>
    </div>
    <div class="p-4">
      <div class="flex flex-wrap gap-2 mb-2">
        <span class="inline-block px-2 py-1 text-xs font-medium rounded-md" style={`background-color: ${getParentCategoryColor(parentCategory)}30; color: ${getParentCategoryColor(parentCategory)};`}>
          {parentCategory}
        </span>
        {category && (
          <span class="inline-block px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 rounded-md">
            {category}
          </span>
        )}
      </div>
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
        {title}
      </h3>
      <p class="mt-1 text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
        {description}
      </p>
      {(techTags.length > 0 || tags?.length > 0) && (
        <div class="mt-3 flex flex-wrap gap-1">
          {techTags.map(tech => (
            <span class="inline-block px-2 py-0.5 text-xs font-medium bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 rounded">
              {tech}
            </span>
          ))}
          {tags?.map(tag => (
            <span class="inline-block px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300 rounded">
              {tag}
            </span>
          ))}
        </div>
      )}
    </div>
  </div>
</a>
